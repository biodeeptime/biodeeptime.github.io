<!DOCTYPE html>




<html
 dir="ltr"
 lang="en"
 >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content=#ffffff>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="shortcut icon" type="image/png"
           href="/favicon.png" 
    />
    <script defer src="https://unpkg.com/alpinejs@3.9.0/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-social@1/bin/bulma-social.min.css">
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Tutorials | BioDeepTime</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Tutorials" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://biodeeptime.github.io/tutorials/" />
<meta property="og:url" content="https://biodeeptime.github.io/tutorials/" />
<meta property="og:site_name" content="BioDeepTime" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Tutorials" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Tutorials","url":"https://biodeeptime.github.io/tutorials/"}</script>
<!-- End Jekyll SEO tag -->

    <!-- head scripts --></head>

  <body>
    <nav class="navbar is-primary " x-data="{ openNav: false }">
    <div class="container">
        <div class="navbar-brand">
            <a href="/" class="navbar-item">
              <img src="https://biodeeptime.github.io/images/logo_proper.png" style="margin-right:5px">
			  BioDeepTime
            </a>
            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu" :class="{ 'is-active': openNav }" x-on:click="openNav = !openNav">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div class="navbar-menu" id="navMenu" :class="{ 'is-active': openNav }">
            <div class="navbar-start">

                
                
                    
                    <a href="/about/us/" class="navbar-item ">About</a>
                    
                
                    
                    <div class="navbar-item has-dropdown is-hoverable ">
                        <a href="" class="navbar-link ">Team</a>
                        <div class="navbar-dropdown">
                            
                            <a href="/team/people/" class="navbar-item ">People</a>
                            
                            <a href="/team/workshops/" class="navbar-item ">Workshops</a>
                            
                            <a href="/team/funding/" class="navbar-item ">Funding</a>
                            
                        </div>
                    </div>
                    
                
                    
                    <div class="navbar-item has-dropdown is-hoverable ">
                        <a href="" class="navbar-link ">Database</a>
                        <div class="navbar-dropdown">
                            
                            <a href="/database/structure/" class="navbar-item ">Structure</a>
                            
                            <a href="/database/contributing/" class="navbar-item ">Contributors</a>
                            
                            <a href="/database/milestones/" class="navbar-item ">Milestones</a>
                            
                            <a href="/database/access/" class="navbar-item ">Access</a>
                            
                            <a href="/database/attribution/" class="navbar-item ">Attribution</a>
                            
                        </div>
                    </div>
                    
                
                    
                    <a href="/tutorials/" class="navbar-item is-active">Tutorials</a>
                    
                
                    
                    <a href="/publications/" class="navbar-item ">Publications</a>
                    
                
                    
                    <a href="/contribute/" class="navbar-item ">Contribute!</a>
                    
                
                    
                    <a href="/contact/" class="navbar-item ">Contact</a>
                    
                
                
            </div>

            <div class="navbar-end">
                
            </div>

        </div>
    </div>
</nav>

    
        <section class="hero  is-medium  is-bold is-primary"  style="background: url('../images/bg/ocean.jpg') no-repeat center center; background-size: cover;" >
    <div class="hero-body ">
        <div class="container">
		  <div class="columns is-vcentered">
			<div class="column is-7">
			  <h1 class="title is-2">Tutorials</h1>
			  <p class="subtitle is-3"></p>
			  
			</div>
			<div class="column is-2" style="text-align:center">
			  <a href="https://biodeeptime.github.io"><img src="https://biodeeptime.github.io/images/logo_proper.png" width="400px"></a>
			</div>
			</div>
        </div>
    </div>
</section>

    
    


    <section class="section">
        <div class="container">
            <div class="columns is-multiline">
                
                <div class="column is-12">
                    
                    
                    
                    
                    
<div class="content">
    ```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(divDyn)
```

The tutorial here represents the absolute basics of using the BioDeepTime database. More elaborate tutorials will be made available on Evolv-ED (Under construction).


## The Data

### Download

The BioDeepTime database is made available through the 'chronosphere' research data API. The [R client](https://cran.r-project.org/package=chronosphere) to access data can be installed from the CRAN servers with:


```{r chroninst, message=FALSE, eval=FALSE, echo=TRUE}
install.packages("chronosphere") # used to call the data
install.packages("tidyverse") # used for data manipulation and plotting
install.packages("ggrepel") # used for plotting
```

The most up-to-date version of the denormalized BioDeepTiem database can be accessed with: 

```{r download}
# attach package
library(chronosphere)
library(tidyverse)
library(ggrepel)

# download data, verbose=FALSE hides the default chatter 
bdt <- fetch("biodeeptime", verbose=FALSE)
```

Note that this table is rather large and might take a bit of time to load. The accessible data items can be downloaded with (`datasets("biodeeptime")`).

### Structure

The default representation of the denormalized table is a `data.frame`, where every row represents one record or biogeographic observation (the presence of a taxon in a sample).

```{r str}
str(bdt)
```

```{r, echo=FALSE, include=FALSE}
##### THIS CHUNK IS NOT PART OF THE TUTORIAL - this creates the summary statistics on the webpage!!!!
refs <- length(unique(unlist(strsplit(bdt$refID, ","))))

summ <- data.frame(
	records=nrow(bdt),
	db=length(table(bdt$db)),
	series=length(table(bdt$seriesID)), 
	samples=length(table(bdt$sampleID)), 
	taxa=length(table(bdt$analyzedTaxon)), 
	from_ma=round(max(bdt$age)/1e4)/100, 
	to_year=1950-min(bdt$age),
	refs=refs
)
write.csv(summ, file="../_data/summary.csv")
##### THIS CHUNK IS NOT PART OF THE TUTORIAL - this creates the summary statistics on the webpage!!!!
```

## Basic analyses

The number of time series in the database:

```{r, dbs}
length(unique(bdt$seriesID))
```

The number of records in the database: 

```{r, dbs2}
length(bdt$db)
```

The number of unique sampling locations:

```{r, dbs3}
nrow(unique(bdt[, c("long", "lat")]))
```

The oldest record (relative to 1950) in each database:
```{r, dbs4}
bdt %>% group_by(db) %>% summarize(max = max(age))
```

Finding the mean age (relative to 1950) of a sample from modern databases (BioTIME and SedTraps):
```{r, dbs5}
modern <- bdt %>%
  filter(db == "BioTIME" | db == "SedTraps") ## filtering to only modern data

mean(modern$age) 

```

Finding the mean age (relative to 1950) of a sample from fossil databases:
```{r, dbs6}
fossil <- bdt %>%
  filter(db != "BioTIME" & db != "SedTraps") ## filtering to exclude modern data

mean(fossil$age) 

```

For additional analyses and visualization, data summarization and manipulation can be done as follows:
```{r}
## this manipulation summarizes information for each unique time series
overview <- bdt %>% 
  group_by(seriesID) %>%
  dplyr::summarise(db = unique(db), ## source database
                   #environment = unique(environment), ## broadly defined environment
                   group = unique(group), ## taxonomic group
                   lat = unique(lat), ## latitude
                   long = unique(long), ## longitude
                   #abundType = unique(abundanceUnit), ## abundance type of records
                   samples = length(unique(sampleID)), ## number of samples
                   richness = length(unique(analyzedTaxon)), ## number of unique species
                   meanAge = mean(age, na.rm = TRUE), ## mean age of samples 
                   minAge = min(age, na.rm = TRUE), ## minimum age of a sample
                   maxAge = max(age, na.rm = TRUE), ## maximum age of a sample
                   extent =  maxAge - minAge) ## temporal extent (duration) of the time series
```

## Visualizing the data

Create a donut plot showing the contribution of source databases to BioDeepTime:
```{r, plot=TRUE}
## donut plot for proportion contribution of each database
databases <- overview %>%
  group_by(db) %>%
  dplyr::summarise(count = n())

# Compute percentages
databases$fraction <- databases$count / sum(databases$count)

# Compute the cumulative percentages (top of each rectangle)
databases$ymax <- cumsum(databases$fraction)

# Compute the bottom of each rectangle
databases$ymin <- c(0, head(databases$ymax, n=-1))

# Compute label position
databases$labelPosition <- (databases$ymax + databases$ymin)/2

# Compute a good label
databases$label <- paste0(databases$db, ", ", databases$count)

# # Make the plot
ggplot(databases, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=db)) +
   geom_rect() +
   geom_label_repel(x = 4, aes(y=labelPosition, label=label), size=4) + ## x controls label position (inside/outside donut)
   scale_fill_brewer(palette = "Set3") +
   coord_polar(theta="y") +
   xlim(c(2, 4)) +
   theme_void() +
   theme(legend.position = "none") ## controls the presence of a legend

```





</div>

                </div>
                
            </div>
        </div>
    </section>
    
        <footer class="footer">
    <div class="container">
        
        
        <div class="columns is-multiline">
            
            <div class="column has-text-centered">
                <div>
                    <a href="/" class="link">Home</a>
                </div>
            </div>
            
            <div class="column has-text-centered">
                <div>
                    <a href="/imprint/" class="link">Imprint</a>
                </div>
            </div>
            
        </div>
        

        <div class="content is-small has-text-centered">

        </div>
    </div>
</footer>

    
    <script src="/assets/js/app.js" type="text/javascript"></script><!-- footer scripts --></body>
</html>
